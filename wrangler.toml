name = "rondevu"
main = "src/worker.ts"
compatibility_date = "2024-01-01"
# Required for crypto and better-sqlite3 compatibility
compatibility_flags = ["nodejs_compat"]
workers_dev = true
preview_urls = true

# Note: api.ronde.vu is a standalone VPS deployment (manual deployment)
# This worker is deployed to test.ronde.vu for testing purposes
routes = [{ pattern = "test.ronde.vu/*", zone_name = "ronde.vu" }]

# Cleanup runs every 5 minutes
[triggers]
crons = ["*/5 * * * *"]

# D1 SQLite database
# Get your database_id: npx wrangler d1 create rondevu-db
[[d1_databases]]
binding = "DB"
database_id = "3d469855-d37f-477b-b139-fa58843a54ff"

[vars]
OFFER_DEFAULT_TTL = "60000"
OFFER_MAX_TTL = "86400000"
OFFER_MIN_TTL = "60000"
MAX_OFFERS_PER_REQUEST = "100"
CORS_ORIGINS = "*"
VERSION = "0.5.13"

# MASTER_ENCRYPTION_KEY must be set as a secret:
# npx wrangler secret put MASTER_ENCRYPTION_KEY
# Generate with: openssl rand -hex 32

[build]
command = ""

# Development: npx wrangler dev
# Deploy: npx wrangler deploy
# Init DB: npx wrangler d1 execute rondevu-db --remote --file=./migrations/schema.sql

[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true
